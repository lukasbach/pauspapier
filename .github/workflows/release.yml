name: Deployment
on:
  workflow_dispatch:

jobs:
  prepare:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build and Lint
        run: |
          yarn
          yarn build
          yarn lint
      # - name: Version Bump
      #   id: versionbump
      #   uses: phips28/gh-action-bump-version@master
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     default: patch
      #     minor-wording: add,Adds,new
      #     major-wording: MAJOR,cut-major
      #     patch-wording: patch,fixes
      #     rc-wording: RELEASE,alpha
      # - name: Create Release
      #   id: createrelease
      #   uses: actions/create-release@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     tag_name: ${{ steps.versionbump.newTag }}
      #     release_name: Release ${{ steps.versionbump.newTag }}
      #     draft: false
      #     prerelease: false

  build_ubuntu:
    runs-on: ubuntu-latest
    needs: prepare
    steps:
      - uses: actions/checkout@v2
      - name: Build
        run: |
          sudo apt-get install libgtk-3-dev
          yarn
          yarn tauri build
          ls ./src-tauri/target/release/
          ls ./src-tauri/target/release/build/

  build_windows:
    runs-on: windows-latest
    needs: prepare
    steps:
      - uses: actions/checkout@v2
      - name: Build
        run: |
          yarn
          yarn tauri build
    #  - name: Upload Release Assets
    #    uses: NBTX/upload-release-assets@v1
    #    env:
    #      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    #    with:
    #      upload_url: ${{ jobs.prepare.outputs.createrelease.outputs.upload_url }}
    #      targets: src-tauri/target

  build_macos:
    runs-on: macos-latest
    needs: prepare
    steps:
      - uses: actions/checkout@v2
      - name: Build
        run: |
          yarn
          yarn tauri build
          ls ./src-tauri/target/release/
          ls ./src-tauri/target/release/build/
